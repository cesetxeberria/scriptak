#labwc lehio kudeatzailea konpilatu
---
- name: Erabiltzeko dependentziak instalatu.
  apt:
    name: "{{ packages }}"
#    install_recommends: no
  vars:
    packages:
    - git
    - meson
    - libwlroots-dev
    - libvulkan-dev
    - glslang-tools
    - hwdata
    - xwayland
    - gettext
    - scdoc
    - cmake
    - polkitd
  when: ansible_distribution_release == 'bookworm'

- name: Konpilatzeko ependentziak instalatu.
  apt:
    name: "{{ packages }}"
#    install_recommends: no
  vars:
    packages:
    - libcairo2-dev
    - libpango1.0-dev
    - libxml2-dev
    - libglib2.0-dev
  when: ansible_distribution_release == 'bookworm'

- name: Download labwc git
  git:
    repo: 'https://github.com/labwc/labwc'
    dest: /home/labwc
#  when: not fsearch_bin.stat.exists

#meson setup build
- name: meson build
  command: "meson build"
  args:
    chdir: "/home/labwc"

#meson compile -C build
- name: ninja -C build
  command: "ninja -C build"
  args:
    chdir: "/home/labwc"

- name: ninja -C build install
  command: "ninja -C build install"
  args:
    chdir: "/home/labwc"

- name: Sortu konfigurazioen karpetak.
  file:
    path: "/etc/xdg/labwc"
    state: directory
    mode: 0755

- name: Jaitsi konfigurazio fitxategiak
  get_url:
    url: "{{ item }}"
    dest: "/etc/xdg/labwc/{{ item }}"
    mode: 0644
  with_items:
    - "https://raw.githubusercontent.com/labwc/labwc/master/docs/rc.xml.all"
    - "https://raw.githubusercontent.com/labwc/labwc/master/docs/menu.xml"
    - "https://raw.githubusercontent.com/labwc/labwc/master/docs/environment"
    - "https://raw.githubusercontent.com/labwc/labwc/master/docs/autostart"

- name: rc.xml izena aldatu
  command: mv /etc/xdg/labwc/rc.xml.all /etc/xdg/labwc/rc.xml
