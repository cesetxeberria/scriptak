#debootstrap-ekin sistema berri bat sortu. aldagaiak hosts fitxategian eta "vars" karpetaren barruan daude
---
  - include_vars: "{{ distro }}.yml"

  - name: Sortu bezeroaren karpeta.
    file:
      path: "{{ inventory_hostname }}/live/squashfs-root"
      state: directory
      mode: 0755

  - name: Ziurtatu ez dela existitzen.
    stat:
      path: "{{ inventory_hostname }}/../filesystem.squashfs"
    register: stat_result

  - name: Existitzen da.
    fail: msg="Karpeta horretan badago filesystem.squash fitxategi bat"
    when: stat_result.stat.exists == True

  - name: Sortu bezeroa debootstrap erabiliz.
    command: /usr/sbin/debootstrap
             --arch={{ arch }}
             --include={{ include_packages }}
             --components={{ compo }}
             --merged-usr
             {{ suite }} {{ inventory_hostname }}/live/squashfs-root {{ repo }}
    when: stat_result.stat.exists == False 
