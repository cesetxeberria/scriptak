- name: jaitsi git
  git:
    repo: 'https://github.com/mamedev/mame'
    dest: /root/mame

- name: Build-depends
  apt:
    name: "{{ packages }}"
  vars:
    packages:
    - debhelper
    - dpkg-dev
    - libexpat1-dev
    - libflac-dev
    - libfontconfig1-dev
    - libglm-dev
    - libjpeg-dev
    - liblua5.3-dev
    - libportmidi-dev
    - libpugixml-dev
    - libsdl2-ttf-dev
    - libsdl2-dev
    - libsqlite3-dev
    - libutil-freebsd-dev
    - libutf8proc-dev
    - libxinerama-dev
    - portaudio19-dev
    - python-dev
    - qtbase5-dev
    - rapidjson-dev
    - zlib1g-dev
    - python3-sphinx

#wget --no-check-certificate 'https://drive.google.com/uc?export=download&id=1rxZGQUNvQ4U3Jxy4xau2Dazr4xANylTh' -O mame.diff
- name: Download groovy.diff
  get_url:
    url: https://drive.google.com/uc?export=download&id=1btHqB7wB19x-vNewKXCmfLvf71l3lDXG
    dest: /root/groovy.diff

- name: Apply patch to multiple files under basedir
  patch:
    src: /root/groovy.diff
    basedir: /root/mame

- name: aldatu makefile
  lineinfile:
    dest: /root/mame/makefile
    regexp: '# QT_HOME = /usr/lib64/qt48/'
    line: 'QT_HOME = /usr/lib/x86_64-linux-gnu/qt5/'
    backrefs: yes

- name: Build
  make:
    chdir: /root/mame
    params:
      NUM_THREADS: 4

- name: Build install
  make:
    chdir: /root/mame
    target: install
